<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Гуртожиток №11</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow: hidden; 
            user-select: none;
            display: flex;
            flex-direction: column;
            background-color: #444;
            touch-action: none; /* Залишаємо це як додатковий захист */
        }

        /* --- БАР СТАТІВ --- */
        .status-bar {
            background-color: #1c1c1c;
            padding: 15px 10px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-around;
            position: relative;
            z-index: 10;
        }
        .stat { width: 20%; display: flex; flex-direction: column; align-items: center; }
        .stat-icon-container { position: relative; font-size: 40px; height: 42px; width: 100%; display: flex; align-items: center; justify-content: center; }
        .stat-icon-bg { color: #555; text-shadow: 0 1px 1px rgba(0,0,0,0.5); position: absolute; }
        .stat-icon-fg { color: #ffffff; text-shadow: 0 1px 1px rgba(0,0,0,0.5); position: absolute; clip-path: inset(50% 0 0 0); transition: clip-path 0.3s ease; }


        /* --- ГОЛОВНА СЦЕНА --- */
        .content-area {
            flex: 1;
            padding: 20px 20px 10px 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around; 
            position: relative;
            width: 100%;
        }

        .message-text {
            font-size: 20px;
            font-weight: 500;
            text-align: center;
            color: #f0f0f0;
            width: 100%;
            max-width: 340px;
        }
        
        .card-stack {
            position: relative;
            width: 85vw; 
            max-width: 340px;
            height: 55vh;
            max-height: 450px; 
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: #3a4a44; 
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            touch-action: none; /* Забороняємо браузеру чіпати картку */
            transition: transform 0.3s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden; 
        }
        .card.is-dragging { transition: none; }
        .card-avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .character-name {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            color: #f0f0f0;
        }

        /* --- НИЖНІЙ БАР --- */
        .footer-bar {
            background-color: #1c1c1c;
            padding: 15px;
            box-sizing: border-box;
            text-align: center;
            position: relative;
            z-index: 10;
        }
        .day-counter {
            font-size: 16px;
            font-weight: bold;
            color: #f0f0f0;
        }

    </style>
</head>
<body>

    <header class="status-bar">
        <div class="stat" id="stat-study"><div class="stat-icon-container"><i class="stat-icon-bg fa-solid fa-brain"></i><i class="stat-icon-fg fa-solid fa-brain"></i></div></div>
        <div class="stat" id="stat-energy"><div class="stat-icon-container"><i class="stat-icon-bg fa-solid fa-bolt"></i><i class="stat-icon-fg fa-solid fa-bolt"></i></div></div>
        <div class="stat" id="stat-money"><div class="stat-icon-container"><i class="stat-icon-bg fa-solid fa-hryvnia-sign"></i><i class="stat-icon-fg fa-solid fa-hryvnia-sign"></i></div></div>
        <div class="stat" id="stat-rep"><div class="stat-icon-container"><i class="stat-icon-bg fa-solid fa-users"></i><i class="stat-icon-fg fa-solid fa-users"></i></div></div>
    </header>
    
    <main class="content-area">

        <p class="message-text" id="message-text">
            Привіт! Ти ж новенький з 404А?
        </p>

        <div class="card-stack">
            <div class="card" id="current-card">
                <img src="avatar_andriy.png" alt="Андрій" class="card-avatar">
            </div>
        </div>

        <p class="character-name" id="character-name">
            Андрій (Сусід)
        </p>

    </main>

    <footer class="footer-bar">
        <div class="day-counter" id="day-counter">
            1 вересня
        </div>
    </footer>
    
    <script>
        window.Telegram.WebApp.ready();
        
        const card = document.getElementById('current-card');
        
        // ❗️ ФІКС UX №1: Повертаємо 'y'
        let x = 0;
        let y = 0;

        interact(card)
            .draggable({
                // ❗️ ФІКС БАГУ: Це має змусити Telegram "віддати" нам дотик
                preventDefault: 'always',
                
                inertia: true,
                autoScroll: false,
                
                onstart: function (event) {
                    event.target.classList.add('is-dragging');
                },

                // ❗️ ФІКС UX №2: Рухаємо картку вільно (з 'y')
                onmove: function (event) {
                    const target = event.target;
                    
                    x += event.dx;
                    y += event.dy; // <-- Повертаємо рух по Y
                    
                    const rotate = x * 0.05;
                    
                    // Рухаємо картку в усіх напрямках
                    target.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(${rotate}deg)`;
                },

                onend: function (event) {
                    const target = event.target;
                    target.classList.remove('is-dragging');

                    const swipeThreshold = 100; // Порог свайпу
                    
                    // ❗️ ФІКС UX №3: Аналізуємо ТІЛЬКИ 'x'
                    if (Math.abs(x) > swipeThreshold) {
                        // Картка "відлітає"
                        const direction = x > 0 ? 1 : -1;
                        // ...але відлітає з тієї 'y' позиції, де її кинули
                        target.style.transform = `translate3d(${direction * 1000}px, ${y}px, 0) rotate(${direction * 60}deg)`;
                        
                        console.log(`Рішення: ${direction > 0 ? 'ВПРАВО' : 'ВЛІВО'}`);
                        
                        setTimeout(() => {
                            // Повертаємо картку (для тесту) і скидаємо ОБИДВІ координати
                            x = 0;
                            y = 0;
                            target.style.transform = 'translate3d(0, 0, 0) rotate(0deg)';
                        }, 1000);

                    } else {
                        // Повертаємо картку на місце (якщо свайп був слабкий або вертикальний)
                        x = 0;
                        y = 0;
                        target.style.transform = 'translate3d(0, 0, 0) rotate(0deg)';
                    }
                }
            });
    </script>
</body>
</html>
